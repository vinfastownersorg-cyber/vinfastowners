# =============================================================================
# OCPP TTS Announcements
# Voice announcements for charging events via Google Home / smart speakers
# =============================================================================
#
# Copy this to your automations/ folder
#
# CUSTOMIZE:
#   - Change media_player.your_speaker to your speaker entity
#   - Adjust the TTS messages as desired
# =============================================================================

# Announce when charging starts
- id: ocpp_announce_charging_started
  alias: "OCPP - Announce Charging Started"
  description: "Announce when EV charging begins"
  trigger:
    - platform: state
      entity_id: sensor.charger_status_connector
      to: "Charging"
  action:
    - service: tts.google_translate_say
      data:
        entity_id: media_player.your_speaker  # <-- CHANGE THIS
        message: "EV charging has started."
  mode: single

# Announce when charging stops/completes
- id: ocpp_announce_charging_stopped
  alias: "OCPP - Announce Charging Stopped"
  description: "Announce when EV charging stops with session summary"
  trigger:
    - platform: state
      entity_id: sensor.charger_status_connector
      from: "Charging"
  action:
    - service: tts.google_translate_say
      data:
        entity_id: media_player.your_speaker  # <-- CHANGE THIS
        message: >
          EV charging complete.
          Session used {{ states('sensor.charger_energy_session') | round(1) }} kilowatt hours,
          costing ${{ states('sensor.charging_session_cost') }}.
  mode: single

# Optional: Morning charging summary
- id: ocpp_morning_summary
  alias: "OCPP - Morning Charging Summary"
  description: "Announce overnight charging summary in the morning"
  trigger:
    - platform: time
      at: "07:00:00"
  condition:
    - condition: template
      value_template: "{{ states('sensor.energy_stats_today') | float(0) > 0 }}"
  action:
    - service: tts.google_translate_say
      data:
        entity_id: media_player.your_speaker  # <-- CHANGE THIS
        message: >
          Good morning. Your VinFast charged
          {{ states('sensor.energy_stats_today') | round(1) }} kilowatt hours overnight,
          adding approximately {{ (states('sensor.energy_stats_today') | float(0) * 3.5) | round(0) }} miles of range.
          Cost was ${{ states('sensor.daily_charging_cost') }}.
  mode: single
